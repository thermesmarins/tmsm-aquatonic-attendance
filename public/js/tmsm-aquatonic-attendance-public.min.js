var TmsmAquatonicAttendanceApp=TmsmAquatonicAttendanceApp||{};!function($){"use strict";var BaseCollection={url:TmsmAquatonicAttendanceApp.ajaxurl,action:"tmsm-aquatonic-attendance-realtime",sync:function(method,object,options){return void 0===options.data&&(options.data={}),options.data.nonce=TmsmAquatonicAttendanceApp.nonce,options.data.action_type=method,void 0===options.data.action&&void 0!==this.action&&(options.data.action=this.action),Backbone.sync(method,object,options)}},BaseModel=Backbone.Model.extend(_.defaults({},BaseCollection)),BaseCollection=Backbone.Collection.extend(_.defaults({},BaseCollection));TmsmAquatonicAttendanceApp.BadgeModel=BaseModel.extend({action:"tmsm-aquatonic-attendance-realtime",defaults:{camera:"",remaining:0,count:0,aquospercentage:0,use:null,color:null,capacity:0,occupation:0,occupation_rounded:0}}),TmsmAquatonicAttendanceApp.BadgesCollection=BaseCollection.extend({action:"tmsm-aquatonic-attendance-realtime",model:TmsmAquatonicAttendanceApp.BadgeModel}),TmsmAquatonicAttendanceApp.BadgesListView=Backbone.View.extend({el:"#tmsm-aquatonic-attendance-badge-container",selectedValue:null,selectedIsVariable:null,selectedHasChoicesVariable:null,selectElement:"#tmsm-aquatonic-attendance-badge-select",loadingElement:"#tmsm-aquatonic-attendance-badge-loading",initialize:function(){this.listenTo(this.collection,"sync",this.render)},events:{"change select":"change"},loading:function(){$(this.loadingElement).show(),$(this.selectElement).hide()},loaded:function(){$(this.loadingElement).hide(),$(this.selectElement).show()},render:function(){var $list=this.$(this.selectElement).empty().val("");return this.collection.each(function(model){var item=new TmsmAquatonicAttendanceApp.BadgesListItemView({model:model});item.template=wp.template("tmsm-aquatonic-attendance-badge-"+model.attributes.camera),$list.append(item.render().$el)},this),this.loaded(),this},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquatonicAttendanceApp.BadgesListItemView=Backbone.View.extend({tagName:"div",className:"tmsm-aquatonic-attendance-badge",template:wp.template("tmsm-aquatonic-attendance-badge"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this}}),TmsmAquatonicAttendanceApp.refreshData=function(){TmsmAquatonicAttendanceApp.badge.fetch({data:{camera:TmsmAquatonicAttendanceApp.camera}})},TmsmAquatonicAttendanceApp.runTimer=function(){null==TmsmAquatonicAttendanceApp.timer&&(TmsmAquatonicAttendanceApp.timer=setInterval(TmsmAquatonicAttendanceApp.refreshData,1e3*TmsmAquatonicAttendanceApp.timer_period))},TmsmAquatonicAttendanceApp.init=function(){TmsmAquatonicAttendanceApp.camera=$("#tmsm-aquatonic-attendance-badge-container").data("camera"),TmsmAquatonicAttendanceApp.badge=new TmsmAquatonicAttendanceApp.BadgesCollection,TmsmAquatonicAttendanceApp.badge.reset(TmsmAquatonicAttendanceApp.data.realtime),TmsmAquatonicAttendanceApp.badgeList=new TmsmAquatonicAttendanceApp.BadgesListView({collection:TmsmAquatonicAttendanceApp.badge}),TmsmAquatonicAttendanceApp.badgeList.render(),TmsmAquatonicAttendanceApp.runTimer(),TmsmAquatonicAttendanceApp.refreshData(),$(function(){$("#tmsm-aquatonic-attendance-badge-container .progress").tooltip()})},$(document).ready(function(){0<$("#tmsm-aquatonic-attendance-badge-container").length&&TmsmAquatonicAttendanceApp.init()})}(jQuery);